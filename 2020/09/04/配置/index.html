<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="generator" content="Hexo 5.1.0"><meta name="theme" content="hexo-theme-yun"><title>VPS配置 | Hexo</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.19/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/","title":"MiFour的收集站","version":"0.9.7","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><meta name="description" content="本文内容适用于 Ubuntu 系统；部分本地操作以在 macOS 下完成为例。 本文部分命令需要以 root 用户或 sudo 权限执行。  最近在 VPS 上搭好了自己的 Tiny Tiny RSS 服务和这个 Blog（有关这两部分的内容我稍后也会写）。而在此之前，我在 VPS 上重新安装了 Ubuntu 18.04 LTS，本文就记录下重装后的一些简单配置过程。 安全SSH 安全为了避免自">
<meta property="og:type" content="article">
<meta property="og:title" content="VPS配置">
<meta property="og:url" content="http://yoursite.com/2020/09/04/%E9%85%8D%E7%BD%AE/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="本文内容适用于 Ubuntu 系统；部分本地操作以在 macOS 下完成为例。 本文部分命令需要以 root 用户或 sudo 权限执行。  最近在 VPS 上搭好了自己的 Tiny Tiny RSS 服务和这个 Blog（有关这两部分的内容我稍后也会写）。而在此之前，我在 VPS 上重新安装了 Ubuntu 18.04 LTS，本文就记录下重装后的一些简单配置过程。 安全SSH 安全为了避免自">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.hly0928.com/media/posts/vps-simple-setup/01.png">
<meta property="article:published_time" content="2020-09-04T05:45:11.000Z">
<meta property="article:modified_time" content="2020-09-04T09:48:21.791Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.hly0928.com/media/posts/vps-simple-setup/01.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="John Doe"><img width="96" loading="lazy" src="/images/g-8yEA1f_400x400.jpg" alt="John Doe"></a><div class="site-author-name"><a href="/about/">John Doe</a></div><a class="site-name" href="/about/site.html">Hexo</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">1</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">1</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://youtube.com" title="Youtube"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="z1968935468@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/McQueenMI4" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/McQueen_MI4" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">1.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH-%E5%AE%89%E5%85%A8"><span class="toc-number">1.1.</span> <span class="toc-text">SSH 安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%B9%B6%E6%B7%BB%E5%8A%A0%E5%AF%86%E9%92%A5"><span class="toc-number">1.1.1.</span> <span class="toc-text">生成并添加密钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD-ssh-%E7%9A%84%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95-amp-%E9%98%B2%E6%AD%A2-Broken-pipe-%E9%94%99%E8%AF%AF"><span class="toc-number">1.1.2.</span> <span class="toc-text">关闭 ssh 的密码登录 &amp; 防止 Broken pipe 错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E4%BA%88-sudo-%E6%9D%83%E9%99%90"><span class="toc-number">1.1.3.</span> <span class="toc-text">创建普通用户并授予 sudo 权限</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7-2"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">创建用户[2]</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%88%E4%BA%88%E7%94%A8%E6%88%B7-sudo-%E6%9D%83%E9%99%90-3"><span class="toc-number">1.1.4.</span> <span class="toc-text">授予用户 sudo 权限[3]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%83%A8%E5%88%86%E6%9C%BA%E5%99%A8-sudo-%E6%8F%90%E7%A4%BA-unable-to-resolve-host-5"><span class="toc-number">1.1.5.</span> <span class="toc-text">解决部分机器 sudo 提示 unable to resolve host[5]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E7%94%A8%E6%88%B7%E5%90%AF%E7%94%A8-SSH-6"><span class="toc-number">1.1.6.</span> <span class="toc-text">为用户启用 SSH[6]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.7.</span> <span class="toc-text">防火墙配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-fail2ban"><span class="toc-number">1.1.7.1.</span> <span class="toc-text">安装 fail2ban</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AE-UFW-%E9%98%B2%E7%81%AB%E5%A2%99-7"><span class="toc-number">1.1.7.2.</span> <span class="toc-text">安装并配置 UFW 防火墙[7]</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ubuntu-%E7%B3%BB%E7%BB%9F%E5%B7%B2%E7%BB%8F%E8%87%AA%E5%B8%A6%E4%BA%86-ufw-%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number"></span> <span class="toc-text">Ubuntu 系统已经自带了 ufw 防火墙</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-NTP-%E5%90%8C%E6%AD%A5%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4"><span class="toc-number">0.0.1.</span> <span class="toc-text">使用 NTP 同步系统时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%B6%E5%8C%BA-8"><span class="toc-number">0.0.2.</span> <span class="toc-text">设置时区[8]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E6%9B%B4%E6%96%B0%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89-9"><span class="toc-number">0.0.3.</span> <span class="toc-text">配置无人值守更新（可选）[9]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E7%94%A8-Canonical-Livepatch-%E6%9C%8D%E5%8A%A1%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-number">0.0.4.</span> <span class="toc-text">启用 Canonical Livepatch 服务（可选）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">0.1.</span> <span class="toc-text">优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E9%AB%98%E6%96%87%E4%BB%B6%E5%B9%B6%E5%8F%91%E6%95%B0"><span class="toc-number">0.1.1.</span> <span class="toc-text">提高文件并发数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98"><span class="toc-number">0.1.2.</span> <span class="toc-text">设置虚拟内存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95"><span class="toc-number">0.1.3.</span> <span class="toc-text">开启 BBR 拥塞控制算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8"><span class="toc-number">0.1.4.</span> <span class="toc-text">自动升级内核</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">0.2.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Docker-CE"><span class="toc-number">0.2.1.</span> <span class="toc-text">安装 Docker-CE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A5%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86-Docker-13"><span class="toc-number">0.2.1.1.</span> <span class="toc-text">以普通用户管理 Docker[13]</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%99%90%E5%88%B6-Docker-%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E5%A4%A7%E5%B0%8F"><span class="toc-number">0.2.1.2.</span> <span class="toc-text">限制 Docker 容器日志大小</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%B8%85%E7%90%86-Docker-%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97"><span class="toc-number">0.2.1.3.</span> <span class="toc-text">手动清理 Docker 容器日志</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3-UFW-%E5%AF%B9-Docker-%E5%AE%B9%E5%99%A8%E6%97%A0%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98-14"><span class="toc-number">0.2.2.</span> <span class="toc-text">解决 UFW 对 Docker 容器无效的问题[14]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%86%A9%EF%B8%8E-%E6%B3%A8"><span class="toc-number">0.2.3.</span> <span class="toc-text">↩︎ 注</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/04/%E9%85%8D%E7%BD%AE/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="John Doe"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">VPS配置</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-09-04 13:45:11" itemprop="dateCreated datePublished" datetime="2020-09-04T13:45:11+08:00">2020-09-04</time></div><div class="post-classify"><span class="post-tag"><a class="tag" href="/tags/%E6%8A%80%E6%9C%AF/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">技术</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><blockquote>
<p>本文内容适用于 Ubuntu 系统；部分本地操作以在 macOS 下完成为例。</p>
<p>本文部分命令需要以 <code>root</code> 用户或 <code>sudo</code> 权限执行。</p>
</blockquote>
<p>最近在 VPS 上搭好了自己的 Tiny Tiny RSS 服务和这个 Blog（有关这两部分的内容我稍后也会写）。而在此之前，我在 VPS 上重新安装了 Ubuntu 18.04 LTS，本文就记录下重装后的一些简单配置过程。</p>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><h3 id="SSH-安全"><a href="#SSH-安全" class="headerlink" title="SSH 安全"></a>SSH 安全</h3><p>为了避免自己的 VPS 被 ssh 弱口令扫描，我们不妨使用公私钥对进行 ssh 登录，并关闭密码登录。</p>
<h4 id="生成并添加密钥"><a href="#生成并添加密钥" class="headerlink" title="生成并添加密钥"></a>生成并添加密钥</h4><p>1.在本地生成密钥</p>
<p>在本机 Terminal 中执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519  <span class="comment"># ED25519 算法，长度固定为 256 bits，安全性和性能最佳，兼容性稍差</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">ssh-keygen -t rsa -b 2048  <span class="comment"># RSA 算法，指定密钥长度为 2048 bits，兼容性最佳</span></span><br></pre></td></tr></table></figure>

<p>提示 <code>Enter file in which to save the key (/Users/~/.ssh/id_ed25519):</code><br><em># 使用默认文件位置，直接回车即可</em></p>
<p>提示 <code>Enter passphrase (empty for no passphrase):</code><br><em># 设置私钥的密码（留空即为免密码）</em></p>
<p>提示 <code>Enter same passphrase again:</code><br><em># 再次输入私钥的密码</em></p>
<p>此时就已经在 <code>~/.ssh/</code> 下生成了 <code>id_ed25519 (或 id_rsa)</code> (私钥) 和 <code>id_ed25519.pub (或 id_rsa.pub)</code> (公钥) 两个文件。</p>
<p>2.在服务器端添加公钥</p>
<p>使用 scp 命令将公钥上传到服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.ssh/id_ed25519.pub root@&lt;VPS域名或IP&gt;:/root/</span><br></pre></td></tr></table></figure>

<p>*# 输入 ssh 密码并回车确认</p>
<p>ssh 到服务器上，随后执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.ssh &amp;&amp; chmod 700 ~/.ssh</span><br><span class="line"></span><br><span class="line">mv id_ed25519.pub ~/.ssh &amp;&amp; <span class="built_in">cd</span> ~/.ssh</span><br><span class="line"></span><br><span class="line">mv id_ed25519.pub authorized_keys &amp;&amp; chmod 600 authorized_keys</span><br></pre></td></tr></table></figure>

<p>此时就可以使用密钥进行 ssh 登录了。</p>
<p>3.macOS 本地配置[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref01">1]</a></p>
<p>如果不想每次使用密钥登录时都要输入密码，那么你可以编辑 ssh 配置文件将密码存储到钥匙串：</p>
<p>编辑 ssh 配置文件：<code>vim ~/.ssh/config</code></p>
<p>写入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  AddKeysToAgent yes  # 用 ssh-agent 管理密钥</span><br><span class="line">  UseKeychain yes  # 将密码存储到钥匙串中</span><br><span class="line">  IdentityFile ~&#x2F;.ssh&#x2F;id_ed25519  # 指定私钥路径</span><br></pre></td></tr></table></figure>

<p>如果你想通过代理 ssh 到你的服务器，那么再写入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Host &lt;VPS域名或IP&gt;</span><br><span class="line">  ProxyCommand nc -X 5 -x 127.0.0.1:6153 %h %p</span><br><span class="line"></span><br><span class="line"># nc, netcat</span><br><span class="line"># -X 5, 指定使用 SOCKS5 代理</span><br><span class="line"># -x, 指定代理的主机地址和端口，示例中为本机的 6153 端口</span><br><span class="line"># %h %p, 用于替换 ssh 实际连接的主机地址和端口</span><br></pre></td></tr></table></figure>

<h4 id="关闭-ssh-的密码登录-amp-防止-Broken-pipe-错误"><a href="#关闭-ssh-的密码登录-amp-防止-Broken-pipe-错误" class="headerlink" title="关闭 ssh 的密码登录 &amp; 防止 Broken pipe 错误"></a>关闭 ssh 的密码登录 &amp; 防止 Broken pipe 错误</h4><p>设置好密钥登录后，我们就可以关闭 ssh 的密码登录了。同时，为了避免在使用 ssh 时空闲连接时间过长而导致 <code>Write failed: Broken pipe</code> 错误，我们可以在 ssh 配置文件中设置 <code>ClientAliveInterval</code> 参数，这会允许服务器在一定时间内发送一个特定的包给客户端，一旦超时，则说明断线，就关闭连接，避免了空闲连接时间过长报错。</p>
<p>编辑 ssh 配置文件：<code>vim /etc/ssh/sshd_config</code></p>
<p>将 <code>PasswordAuthentication yes</code> 改为 <code>PasswordAuthentication no</code>，并去除行前的注释符号 <code>#</code><br>将 <code>ClientAliveInterval</code> 一行改为 <code>ClientAliveInterval 60</code>，并去除行前的注释符号 <code>#</code><br>保存退出，执行 <code>/etc/init.d/ssh restart</code> 重启 ssh 服务即可。</p>
<h4 id="创建普通用户并授予-sudo-权限"><a href="#创建普通用户并授予-sudo-权限" class="headerlink" title="创建普通用户并授予 sudo 权限"></a>创建普通用户并授予 sudo 权限</h4><h5 id="创建用户-2"><a href="#创建用户-2" class="headerlink" title="创建用户[2]"></a>创建用户[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref02">2]</a></h5><p>首先，使用 <code>useradd</code> 命令创建用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useradd -m -s /bin/bash &lt;username&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加用户名为 &lt;username&gt; 的用户</span></span><br><span class="line"><span class="comment"># -m, 自动创建用户家目录，并将 /etc/skel 中的文件复制到家目录中</span></span><br><span class="line"><span class="comment"># -s /bin/bash, 指定用户默认 shell 为 bash</span></span><br></pre></td></tr></table></figure>

<p>然后为该用户设置密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd &lt;username&gt;</span><br></pre></td></tr></table></figure>

<h4 id="授予用户-sudo-权限-3"><a href="#授予用户-sudo-权限-3" class="headerlink" title="授予用户 sudo 权限[3]"></a>授予用户 sudo 权限[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref03">3]</a></h4><p>一般来说，Ubuntu 系统已经自带了 <code>sudo</code>；如果没有，则先安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install sudo</span><br></pre></td></tr></table></figure>

<p>由于直接修改 <code>etc/sudoers</code> 文件有一定的危险性，因此我们采用将配置文件追加到 <code>/etc/sudoers.d/</code> 目录下的方式进行配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;username&gt; ALL=(ALL) ALL&#x27;</span> &gt;&gt; /etc/sudoers.d/&lt;username&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请自行将 &lt;username&gt; 改为你的用户名</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;username&gt; ALL=(ALL) ALL</code> 表示普通用户 <code>&lt;username&gt;</code> 可以在任何主机上，通过 <code>sudo</code> 提权到任何用户/用户组，执行任何命令[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref04">4]</a>。</p>
<p>如果你想免密使用 <code>sudo</code><strong>（不安全）</strong>，那么上一步可以改为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;username&gt; ALL=(ALL) NOPASSWD: ALL&#x27;</span> &gt;&gt; /etc/sudoers.d/&lt;username&gt;</span><br></pre></td></tr></table></figure>

<h4 id="解决部分机器-sudo-提示-unable-to-resolve-host-5"><a href="#解决部分机器-sudo-提示-unable-to-resolve-host-5" class="headerlink" title="解决部分机器 sudo 提示 unable to resolve host[5]"></a>解决部分机器 sudo 提示 unable to resolve host[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref05">5]</a></h4><p>部分服务器在执行 <code>sudo</code> 时，会弹出以下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">sudo: unable to resolve host &lt;hostname&gt;</span><br></pre></td></tr></table></figure>

<p>尽管不影响使用，但看着总让人不爽。这个错误是因为服务商提供的默认系统镜像没有将主机名 (hostname) 添加到 <code>/etc/hosts</code> 文件中，导致系统无法解析 hostname。使用以下命令即可解决：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;127.0.0.1 <span class="subst">$(hostname)</span>&quot;</span> | sudo tee -a /etc/hosts</span><br></pre></td></tr></table></figure>

<h4 id="为用户启用-SSH-6"><a href="#为用户启用-SSH-6" class="headerlink" title="为用户启用 SSH[6]"></a>为用户启用 SSH[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref06">6]</a></h4><p>首先切换到刚刚创建的用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - &lt;username&gt;</span><br></pre></td></tr></table></figure>

<p>随后，建立 <code>~/.ssh</code> 目录，并将 <code>root</code> 用户下的 <code>authorized_keys</code> 复制过来：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.ssh/</span><br><span class="line"></span><br><span class="line">sudo cp /root/.ssh/authorized_keys ~/.ssh/</span><br></pre></td></tr></table></figure>

<p>最后设置正确的访问权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R &lt;username&gt;:&lt;username&gt; ~/.ssh</span><br><span class="line">sudo chmod 700 ~/.ssh</span><br><span class="line">sudo chmod 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p>为了提高安全性，你还可以关闭 <code>root</code> 用户的 ssh 登录。编辑 ssh 配置文件：<code>vim /etc/ssh/sshd_config</code></p>
<p>将 <code>PermitRootLogin yes</code> 改为 <code>PermitRootLogin no</code>，并去除行前的注释符号 <code>#</code><br>保存退出，执行 <code>/etc/init.d/ssh restart</code> 重启 ssh 服务即可。</p>
<h4 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h4><h5 id="安装-fail2ban"><a href="#安装-fail2ban" class="headerlink" title="安装 fail2ban"></a>安装 fail2ban</h5><p>fail2ban 是 Linux 上一个著名的入侵保护的开源框架，它能通过 iptables 将尝试暴破 ssh 密码的 IP 封停，有效防止暴力破解攻击。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install fail2ban</span><br></pre></td></tr></table></figure>

<h5 id="安装并配置-UFW-防火墙-7"><a href="#安装并配置-UFW-防火墙-7" class="headerlink" title="安装并配置 UFW 防火墙[7]"></a>安装并配置 UFW 防火墙[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref07">7]</a></h5><p>ufw，即 uncomplicated firewall（简单防火墙），是 Ubuntu 系统默认的防火墙组件，它可以简化对 iptables 的配置。</p>
<ul>
<li><p>如果未安装 ufw，则先进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install ufw</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Ubuntu-系统已经自带了-ufw-防火墙"><a href="#Ubuntu-系统已经自带了-ufw-防火墙" class="headerlink" title="Ubuntu 系统已经自带了 ufw 防火墙"></a>Ubuntu 系统已经自带了 ufw 防火墙</h1><ul>
<li><p>添加基本的 ufw 规则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ufw allow http  <span class="comment"># 允许 80 端口传入连接</span></span><br><span class="line"></span><br><span class="line">ufw allow https  <span class="comment"># 允许 443 端口传入连接</span></span><br><span class="line"></span><br><span class="line">ufw allow ssh  <span class="comment"># 允许 22 端口传入连接</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加自定义端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ufw allow 端口号</span><br><span class="line"></span><br><span class="line">ufw allow 10000:20000/tcp  <span class="comment"># 此处指定了 10000 到 20000 的端口范围，并指定只允许 TCP 连接</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>开启 ufw</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">enable</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>#会提示你可能影响 ssh 连接，务必确认已将你的 ssh 端口加入到 ufw rules 中，然后按 y 确认开启</p>
<ul>
<li><p>查看 ufw 状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw status</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除某条规则</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw delete allow 端口号</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="使用-NTP-同步系统时间"><a href="#使用-NTP-同步系统时间" class="headerlink" title="使用 NTP 同步系统时间"></a>使用 NTP 同步系统时间</h4><p>许多服务都要求服务器时间与标准时间误差不能过大，因此我们使用 NTP 进行时间同步。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install ntp</span><br></pre></td></tr></table></figure>

<h4 id="设置时区-8"><a href="#设置时区-8" class="headerlink" title="设置时区[8]"></a>设置时区[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref08">8]</a></h4><p>切换到与所在地相同的时区可以方便 crontab 等服务的设置。</p>
<p>查看可用时区列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl list-timezones</span><br></pre></td></tr></table></figure>

<p>设定时区：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl <span class="built_in">set</span>-timezone Asia/Hong_Kong  <span class="comment"># 将时区设置为 Asia/Hong_Kong</span></span><br></pre></td></tr></table></figure>

<p>查看当前时间设定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl</span><br></pre></td></tr></table></figure>

<h4 id="配置无人值守更新（可选）-9"><a href="#配置无人值守更新（可选）-9" class="headerlink" title="配置无人值守更新（可选）[9]"></a>配置无人值守更新（可选）[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref09">9]</a></h4><p>一般来说，Ubuntu 系统已经自带了 <code>unattended-upgrades</code> 包；如果没有，则先安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install unattended-upgrades</span><br></pre></td></tr></table></figure>

<p>随后，通过以下命令启用无人值守更新：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;unattended-upgrades unattended-upgrades/enable_auto_updates boolean true&quot;</span> | debconf-set-selections</span><br><span class="line"></span><br><span class="line">DEBIAN_FRONTEND=noninteractive dpkg-reconfigure unattended-upgrades</span><br></pre></td></tr></table></figure>

<p>通过编辑 <code>/etc/apt/apt.conf.d/</code> 下的 <code>20auto-upgrades</code> 和 <code>50unattended-upgrades</code> 两个配置文件，我们可以设定无人值守更新。</p>
<ul>
<li><p><code>/etc/apt/apt.conf.d/20auto-upgrades</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">APT::Periodic::Update-Package-Lists &quot;1&quot;;</span><br><span class="line"># 自动更新软件包列表周期（天），0 为关闭</span><br><span class="line"></span><br><span class="line">APT::Periodic::Download-Upgradeable-Packages &quot;0&quot;;</span><br><span class="line"># 自动下载可更新的软件包周期（天），0 为关闭</span><br><span class="line"></span><br><span class="line">APT::Periodic::AutocleanInterval &quot;0&quot;;</span><br><span class="line"># 自动清理周期（天），0 为关闭</span><br><span class="line"></span><br><span class="line">APT::Periodic::Unattended-Upgrade &quot;1&quot;;</span><br><span class="line"># 自动更新软件包周期（天），0 为关闭</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>/etc/apt/apt.conf.d/50unattended-upgrades</code></p>
</li>
</ul>
<p>以下为一些关键的设置项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Unattended-Upgrade::Allowed-Origins &#123;</span><br><span class="line">... ...</span><br><span class="line">&#x2F;&#x2F;&quot;$&#123;distro_id&#125;:$&#123;distro_codename&#125;-updates&quot;;</span><br><span class="line">&#x2F;&#x2F; 自动更新（除安全更新外的）软件包，去除行前的注释符号 &#x2F;&#x2F; 以开启</span><br><span class="line">&#x2F;&#x2F; 注意：开启此选项有风险</span><br><span class="line">    ... ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Unattended-Upgrade::Remove-Unused-Kernel-Packages &quot;true&quot;;</span><br><span class="line">&#x2F;&#x2F; 自动移除无用内核，去除行前的注释符号 &#x2F;&#x2F; 以开启</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;Unattended-Upgrade::Remove-Unused-Dependencies &quot;false&quot;;</span><br><span class="line">&#x2F;&#x2F; 自动移除无用依赖，去除行前的注释符号 &#x2F;&#x2F; 并将 false 改为 true 以开启</span><br><span class="line">&#x2F;&#x2F; 等同于自动 apt-get autoremove</span><br></pre></td></tr></table></figure>

<p>本配置文件还提供了许多其他的设置项，并且有详细的注释，可自行查看编辑。</p>
<h4 id="启用-Canonical-Livepatch-服务（可选）"><a href="#启用-Canonical-Livepatch-服务（可选）" class="headerlink" title="启用 Canonical Livepatch 服务（可选）"></a>启用 Canonical Livepatch 服务（可选）</h4><p>在 Ubuntu 16.04 及以上的系统中，可以使用 Canonical Livepatch 服务实现无需重启系统就能安装内核安全补丁。同时，Canonical Livepatch 服务对于不超过 3 台机器的个人用户是免费的。</p>
<ol>
<li><p>在 <a target="_blank" rel="noopener" href="https://auth.livepatch.canonical.com/">Canonical Livepatch Service 官网</a> 上选择 <code>Ubuntu user</code>，点击 <code>Get your Livepatch token</code></p>
</li>
<li><p>按要求注册（或登录）Ubuntu One 账号，获取 token</p>
</li>
<li><p>ssh 到服务器上，随后安装 Snapd 守护程序：</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install snapd</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>安装 Canonical Livepatch 守护程序：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snap install canonical-livepatch</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>启用 Canonical Livepatch：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">canonical-livepatch <span class="built_in">enable</span> &lt;token&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请自行将 &lt;token&gt; 换成第二步中获取的 token</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>查看 Canonical Livepatch 状态：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canonical-livepatch status</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>手动更新补丁：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canonical-livepatch refresh</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>停用 Canonical Livepatch：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snap run canonical-livepatch <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：安装内核补丁与安装新内核不同，如果安装了新内核，则必须重新启动系统以应用新内核。</p>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><h4 id="提高文件并发数"><a href="#提高文件并发数" class="headerlink" title="提高文件并发数"></a>提高文件并发数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;* soft nofile 51200</span></span><br><span class="line"><span class="string">* hard nofile 51200&#x27;</span> &gt;&gt; /etc/security/limits.conf</span><br></pre></td></tr></table></figure>

<p>然后，执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -n 51200</span><br></pre></td></tr></table></figure>

<h4 id="设置虚拟内存"><a href="#设置虚拟内存" class="headerlink" title="设置虚拟内存"></a>设置虚拟内存</h4><p>某些 VPS 服务商会预先设置好虚拟内存，所以我们先查看系统当前可用内存：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -m</span><br></pre></td></tr></table></figure>

<p>输出样例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ free -m</span><br><span class="line"></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line"></span><br><span class="line">Mem:            982         277         112           1         592         533</span><br><span class="line"></span><br><span class="line">Swap:          1023           2        1021</span><br></pre></td></tr></table></figure>

<p>如果输出中没有上面的 <code>Swap</code> 一行或 <code>Swap</code> 后为 0，则表示系统没有设置虚拟内存，可以参考下面的方法设置：</p>
<ol>
<li>创建 swapfile</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/root/swapfile bs=1M count=1024</span><br><span class="line"><span class="comment"># if 表示 input file (输入文件)，of 表示 output file (输出文件)，bs 表示 block size (块大小)，count 表示计数</span></span><br></pre></td></tr></table></figure>

<p>示例中采用的数据块大小为 1M，数据块计数为 1024，所以分配的空间就是 1G 大小。</p>
<ol start="2">
<li>设置正确的 swapfile 权限</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 /root/swapfile</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>格式化 swapfile</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkswap /root/swapfile</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启用 swapfile</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon /root/swapfile</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>设置开机自动加载虚拟内存</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/root/swapfile swap swap defaults 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>

<p>此时再执行 <code>free -m</code> 即可看到虚拟内存已经启用了。</p>
<h4 id="开启-BBR-拥塞控制算法"><a href="#开启-BBR-拥塞控制算法" class="headerlink" title="开启 BBR 拥塞控制算法"></a>开启 BBR 拥塞控制算法</h4><p>BBR 是 Google 出品的 TCP 拥塞控制算法，其目的是尽量跑满带宽，可以起到单边加速 TCP 连接的效果。BBR 是内嵌在 Linux 内核中的，而 Linux kernel 4.9 已加入了该算法。如果你的系统内核版本低于 4.9，则需要先升级 Linux 内核。<br>*# Ubuntu 18.04 及以上系统内核版本已高于 4.9，可直接开启 BBR*</p>
<ol>
<li>开启 BBR</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.core.default_qdisc=fq&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.tcp_congestion_control=bbr&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>

<p>然后，执行 <code>sysctl -p</code> 保存生效。</p>
<ol start="2">
<li>查看 BBR 是否成功开启</li>
</ol>
<p>执行 <code>sysctl net.ipv4.tcp_available_congestion_control</code>， 结果中应有 <code>bbr</code>。<br>执行 <code>lsmod | grep bbr</code>，结果中应有 <code>tcp_bbr</code>。</p>
<p>输出样例：</p>
<p><img src="https://blog.hly0928.com/media/posts/vps-simple-setup/01.png" alt="img" loading="lazy"></p>
<h4 id="自动升级内核"><a href="#自动升级内核" class="headerlink" title="自动升级内核"></a>自动升级内核</h4><p>默认情况下，Ubuntu LTS 将保持在最初发布的 Linux 内核上。而 Ubuntu 硬件支持栈（<strong>H</strong>ard<strong>w</strong>are <strong>E</strong>nablement Stacks, HWE）可以为现有的 Ubuntu LTS 提供更新的内核支持，实现内核自动升级，方便我们体验较新内核的特性[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref10">10]</a>。</p>
<ol>
<li>查看当前系统内核版本</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装 HWE</li>
</ol>
<p>使用包管理器即可安装 HWE：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install --install-recommends linux-generic-hwe-20.04  <span class="comment"># For Ubuntu 20.04 LTS</span></span><br><span class="line"></span><br><span class="line">apt install --install-recommends linux-generic-hwe-18.04  <span class="comment"># For Ubuntu 18.04 LTS</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>重启系统以应用新内核</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>删除旧内核（可选）[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref11">11]</a></li>
</ol>
<p>使用包管理器自动卸载即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt autoremove --purge</span><br></pre></td></tr></table></figure>

<p>如果只想保留当前最新的内核，可以使用以下命令<strong>（有风险，慎用）</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt purge $(dpkg -l | grep -E <span class="string">&quot;linux-(image|headers|modules)&quot;</span> | grep -v hwe | grep -v $(uname -r | cut -d <span class="string">&#x27;-&#x27;</span> -f1,2) | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>或者也可以手动卸载：</p>
<p><strong>卸载旧版 linux-image：</strong></p>
<p>获取 linux-image 列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep linux-image</span><br></pre></td></tr></table></figure>

<p>卸载旧版 linux-image：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt purge &lt;旧linux-image名&gt;</span><br></pre></td></tr></table></figure>

<p><strong>卸载旧版 linux-headers：</strong></p>
<p>获取 linux-headers 列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep linux-headers</span><br></pre></td></tr></table></figure>

<p>卸载旧版 linux-headers：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt purge &lt;旧linux-headers名&gt;</span><br></pre></td></tr></table></figure>

<p><strong>卸载旧版 linux-modules：</strong></p>
<p>获取 linux-modules 列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep linux-modules</span><br></pre></td></tr></table></figure>

<p>卸载旧版 linux-modules：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt purge &lt;旧linux-modules名&gt;</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="安装-Docker-CE"><a href="#安装-Docker-CE" class="headerlink" title="安装 Docker-CE"></a>安装 Docker-CE</h4><p><a target="_blank" rel="noopener" href="https://www.docker.com/">Docker</a> 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。iOS 上的 <a target="_blank" rel="noopener" href="https://www.hyperapp.fun/zh/">HyperApp</a> 也正是借助 Docker 实现了自动部署应用。</p>
<p>安装 Docker 最方便的方式是使用官方脚本[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref12">12]</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- get.docker.com | bash</span><br></pre></td></tr></table></figure>

<p>对于国内 VPS，还可以指定使用阿里云镜像进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure>

<h5 id="以普通用户管理-Docker-13"><a href="#以普通用户管理-Docker-13" class="headerlink" title="以普通用户管理 Docker[13]"></a>以普通用户管理 Docker[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref13">13]</a></h5><p>由于 Docker 守护进程绑定在 Unix socket 上，而 Unix socket 默认仅属于 <code>root</code> 用户，因此在通过普通用户管理 Docker 时，我们需要在命令前加上 <code>sudo</code>。为了方便使用，我们可以将普通用户添加到 <code>docker</code> 用户组中，这样就能直接使用 <code>docker</code> 命令而不需要 <code>sudo</code>。</p>
<ol>
<li>创建 <code>docker</code> 用户组</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 较新的 Docker 安装中可能已经添加了 docker 用户组</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将当前用户加入 <code>docker</code> 组</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gpasswd -a <span class="variable">$USER</span> docker</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>登出并重新登入当前用户</li>
</ol>
<p>或者，你也可以使用 <code>newgrp</code> 命令以 <code>docker</code> 组重新登入系统：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newgrp docker</span><br></pre></td></tr></table></figure>

<p>此时就可以直接使用 <code>docker</code> 命令管理容器了。</p>
<h5 id="限制-Docker-容器日志大小"><a href="#限制-Docker-容器日志大小" class="headerlink" title="限制 Docker 容器日志大小"></a>限制 Docker 容器日志大小</h5><p>Docker 容器运行过程中会产生大量日志文件，如果不加限制可能会导致 VPS 磁盘空间不足。通过编辑 Docker 配置文件，我们可以限制容器日志大小。</p>
<p>编辑 <code>/etc/docker/daemon.json</code> 文件：<code>vim /etc/docker/daemon.json</code></p>
<p>添加 <code>log-dirver</code>和 <code>log-opts</code> 参数：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;log-opts&quot;</span>: &#123; <span class="attr">&quot;max-size&quot;</span>: <span class="string">&quot;50m&quot;</span>, <span class="attr">&quot;max-file&quot;</span>: <span class="string">&quot;3&quot;</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>#样例中一个容器的日志大小上限是 50 M，最多创建 3 个日志文件</p>
<p>对于国内 VPS，还可以在配置文件中配置国内镜像源：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;log-opts&quot;</span>: &#123; <span class="attr">&quot;max-size&quot;</span>: <span class="string">&quot;50m&quot;</span>, <span class="attr">&quot;max-file&quot;</span>: <span class="string">&quot;3&quot;</span> &#125;,</span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://&lt;阿里云ID&gt;.mirror.aliyuncs.com&quot;</span>,<span class="string">&quot;https://registry.docker-cn.com&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>#阿里云源地址可以在 <a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/">容器镜像服务</a> &gt; 镜像加速器 下查看</p>
<p>保存退出，随后加载配置文件并重启 Docker：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>#设置的日志大小，只对新建的容器有效</p>
<h5 id="手动清理-Docker-容器日志"><a href="#手动清理-Docker-容器日志" class="headerlink" title="手动清理 Docker 容器日志"></a>手动清理 Docker 容器日志</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps | awk <span class="string">&#x27;&#123;if (NR&gt;1)&#123;print $1&#125;&#125;&#x27;</span> | xargs docker inspect --format=<span class="string">&#x27;&#123;&#123;.LogPath&#125;&#125;&#x27;</span> | xargs truncate -s 0</span><br></pre></td></tr></table></figure>

<h4 id="解决-UFW-对-Docker-容器无效的问题-14"><a href="#解决-UFW-对-Docker-容器无效的问题-14" class="headerlink" title="解决 UFW 对 Docker 容器无效的问题[14]"></a>解决 UFW 对 Docker 容器无效的问题[<a target="_blank" rel="noopener" href="https://blog.hly0928.com/post/vps-simple-setup/#ref14">14]</a></h4><p>在使用 Docker 暴露容器端口时，Docker 会直接操作 iptables NAT 规则，导致 ufw 无法管理 Docker 所发布的端口，这是一个严重的安全问题。好在通过编辑 ufw 的 <code>after.rules</code>，我们能够解决这一问题。</p>
<p>编辑 ufw 的 <code>after.rules</code>：<code>vim /etc/ufw/after.rules</code></p>
<p>在末尾写入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># BEGIN UFW AND DOCKER</span><br><span class="line">*filter</span><br><span class="line">:ufw-user-forward - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A DOCKER-USER -j RETURN -s 10.0.0.0&#x2F;8</span><br><span class="line">-A DOCKER-USER -j RETURN -s 172.16.0.0&#x2F;12</span><br><span class="line">-A DOCKER-USER -j RETURN -s 192.168.0.0&#x2F;16</span><br><span class="line"></span><br><span class="line">-A DOCKER-USER -j ufw-user-forward</span><br><span class="line"></span><br><span class="line">-A DOCKER-USER -j DROP -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -d 192.168.0.0&#x2F;16</span><br><span class="line">-A DOCKER-USER -j DROP -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -d 10.0.0.0&#x2F;8</span><br><span class="line">-A DOCKER-USER -j DROP -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -d 172.16.0.0&#x2F;12</span><br><span class="line">-A DOCKER-USER -j DROP -p udp -m udp --dport 0:32767 -d 192.168.0.0&#x2F;16</span><br><span class="line">-A DOCKER-USER -j DROP -p udp -m udp --dport 0:32767 -d 10.0.0.0&#x2F;8</span><br><span class="line">-A DOCKER-USER -j DROP -p udp -m udp --dport 0:32767 -d 172.16.0.0&#x2F;12</span><br><span class="line"></span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"># END UFW AND DOCKER</span><br></pre></td></tr></table></figure>

<p>保存退出，随后重启 ufw：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart ufw</span><br></pre></td></tr></table></figure>

<p><em># 如果重启 ufw 之后规则没有生效，则需要重启服务器。</em></p>
<p>如果你要允许外部网络访问所有 Docker 发布的、内部端口为 <code>80</code> 的服务，则执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ufw route allow from any to any port 80</span><br><span class="line"></span><br><span class="line">ufw route allow proto tcp from any to any port 80  <span class="comment"># 仅允许 TCP 协议</span></span><br></pre></td></tr></table></figure>

<p><em># 此处的 <code>80</code> 是容器内部端口，而非使用 <code>-p 8080:80</code> 选项发布在服务器上的 <code>8080</code> 端口。</em></p>
<hr>
<h4 id="↩︎-注"><a href="#↩︎-注" class="headerlink" title="↩︎ 注"></a>↩︎ 注</h4><ol>
<li>参考 <a target="_blank" rel="noopener" href="https://help.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">GitHub Help - Generating a new SSH key and adding it to the ssh-agent</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://p3terx.com/archives/add-normal-users-with-adduser-and-useradd.html">Linux 使用 adduser 与 useradd 添加普通用户的正确姿势</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://p3terx.com/archives/linux-grants-normal-user-sudo-permission.html">Linux 中授予普通用户 sudo 权限的正确方法</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000007394449">sudoers 的深入剖析与用户权限控制</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/59458/error-message-sudo-unable-to-resolve-host-none">askubuntu - Error message “sudo: unable to resolve host (none)”</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/16650/create-a-new-ssh-user-on-ubuntu-server">askubuntu - Create a new SSH user on Ubuntu Server</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/UFW">Ubuntu Community Help Wiki - UFW</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://linuxize.com/post/how-to-set-or-change-timezone-on-ubuntu-18-04">How To Set or Change Timezone on Ubuntu 18.04</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/AutomaticSecurityUpdates">Ubuntu Community Help Wiki - AutomaticSecurityUpdates</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://wiki.ubuntu.com/Kernel/LTSEnablementStack">Ubuntu Community Help Wiki - LTSEnablementStack</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/RemoveOldKernels">Ubuntu Community Help Wiki - RemoveOldKernels</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/ubuntu">Docker Documentation - Install Docker Engine on Ubuntu</a></li>
<li>参考 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/linux-postinstall">Docker Documentation - Post-installation steps for Linux</a></li>
<li>参考 [不用禁用 iptables 来解决 UFW 和 Docker 的安全问题](<a target="_blank" rel="noopener" href="https://chaifeng.com/to-fix-ufw-and-docker-security-flaw-without-disabling-iptables/">https://chaifeng.com/to-fix-ufw-and-docker-security-flaw-without-disabling-iptables/</a></li>
</ol>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>John Doe</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://yoursite.com/2020/09/04/%E9%85%8D%E7%BD%AE/" title="VPS配置">http://yoursite.com/2020/09/04/%E9%85%8D%E7%BD%AE/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/YunYouJun/yunyoujun.github.io/issues?q=is:issue+VPS配置">GitHub Issues</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> John Doe</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.1.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v0.9.7</span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script></body></html>